<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Welcome â€“ English Voice Club</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <meta name="description" content="Log in or create an English Voice Club account.">

  <!-- âœ… shared look & feel -->
  <link rel="stylesheet" href="shared.css">

  <!-- ðŸ”’ tiny override so the form card is centered -->
  <style>
    body{
      display:flex;
      flex-direction:column;
      min-height:100vh;
    }
    main{
      flex:1;
      display:grid;
      place-items:center;
      padding:2rem 1rem;
    }
    .login-card{
      width:100%;
      max-width:400px;
      text-align:center;
    }
    .logo svg{
      width:48px;
      height:48px;
      color:currentColor;
      margin-bottom:.5rem;
    }
    label{
      display:block;
      text-align:left;
      margin-bottom:1rem;
      font-size:.875rem;
    }
    input,select{
      width:100%;
      margin-top:.25rem;
      padding:.5rem .75rem;
      border:1px solid var(--card-border);
      border-radius:.5rem;
      background:var(--card-bg);
      color:var(--text);
      font-family:inherit;
    }
    .link-btn{
      background:none;
      border:none;
      color:var(--muted);
      text-decoration:underline;
      cursor:pointer;
    }
    .toggle-row{margin-top:1rem;font-size:.875rem}
    .banner-error{color:var(--error);margin-top:1rem}
  </style>
</head>

<!-- Decorative layers (same as index & dashboard) -->
<div style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2;background:var(--bg-light)"></div>
<div style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;background:url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23fff\' fill-opacity=\'.03\'%3E%3Ccircle cx=\'30\' cy=\'30\' r=\'4\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')"></div>

<body>
  <!-- Dark / light toggle (top-right) -->
  <button id="themeToggle" class="btn-primary" style="position:fixed;top:.75rem;right:.75rem;font-size:.75rem;padding:.5rem .75rem">
    ðŸŒ“
  </button>

  <main>
    <section class="card login-card">
      <header class="logo">
        <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2z"/>
          <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
          <circle cx="9" cy="9" r="1"/><circle cx="15" cy="9" r="1"/>
        </svg>
        <h1>English Voice Club</h1>
      </header>

      <p id="subline" class="tagline">Welcome back!</p>

      <form id="authForm" novalidate>
        <label>
          Email
          <input type="email" id="email" placeholder="you@example.com" required autocomplete="email">
        </label>

        <label>
          Password
          <input type="password" id="pw" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6" required autocomplete="current-password">
        </label>

        <button type="button" id="forgotPwBtn" class="link-btn" hidden>Forgot password?</button>

        <label id="ageLabel">
          Age group
          <select id="cat" required>
            <option value="" disabled selected>Select category</option>
            <option value="under8">Under 8</option>
            <option value="8-13">8 â€“ 13</option>
            <option value="13-17">13 â€“ 17</option>
            <option value="18plus">18+</option>
          </select>
        </label>

        <div class="toggle-row">
          <span id="toggleText">Need an account?</span>
          <button type="button" id="toggleBtn" class="link-btn">Sign up</button>
        </div>

        <button type="submit" id="submitBtn" class="btn-primary" aria-busy="false">
          <span id="btnText">Log in</span>
        </button>

        <p id="errorBanner" class="banner-error" role="alert" hidden></p>
      </form>

      <footer class="tiny" style="margin-top:1.5rem">Â© 2025 English Voice Club</footer>
    </section>
  </main>

  <!-- Firebase logic (unchanged) -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js';
    import {
      getAuth,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      sendPasswordResetEmail
    } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js';
    import { getFirestore, doc, setDoc } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js';

    const app = initializeApp({
      apiKey: "AIzaSyCBG65IYMUSjzGqQPhysMcZjTNIw3h-5B4",
      authDomain: "englishlearningclubindia.firebaseapp.com",
      projectId: "englishlearningclubindia",
      storageBucket: "englishlearningclubindia.firebasestorage.app",
      messagingSenderId: "252611300228",
      appId: "1:252611300228:web:62ae9614f1e62e075f2bd1"
    });
    const auth = getAuth(app);
    const db   = getFirestore(app);

    const els = {
      form: document.getElementById('authForm'),
      email: document.getElementById('email'),
      pw: document.getElementById('pw'),
      cat: document.getElementById('cat'),
      btnText: document.getElementById('btnText'),
      subline: document.getElementById('subline'),
      ageLabel: document.getElementById('ageLabel'),
      forgotBtn: document.getElementById('forgotPwBtn'),
      banner: document.getElementById('errorBanner'),
      submitBtn: document.getElementById('submitBtn'),
      toggleBtn: document.getElementById('toggleBtn'),
      toggleText: document.getElementById('toggleText')
    };

    let mode = 'login';
    function renderMode(){
      const isLogin = mode === 'login';
      els.btnText.textContent   = isLogin ? 'Log in' : 'Create account';
      els.subline.textContent   = isLogin ? 'Welcome back!' : 'Join the weekly speaking challenge';
      els.ageLabel.hidden       = isLogin;
      els.forgotBtn.hidden      = !isLogin;
      els.toggleText.textContent= isLogin ? 'Need an account?' : 'Already have an account?';
      els.toggleBtn.textContent = isLogin ? 'Sign up' : 'Log in';
    }
    els.toggleBtn.addEventListener('click', () => {
      mode = mode === 'login' ? 'register' : 'login';
      renderMode();
    });

    els.form.addEventListener('submit', async e => {
      e.preventDefault();
      if (els.submitBtn.disabled) return;
      els.submitBtn.disabled = true;
      els.submitBtn.setAttribute('aria-busy', 'true');
      els.banner.hidden = true;
      const email = els.email.value;
      const pass  = els.pw.value;
      try {
        if (mode === 'login') {
          await signInWithEmailAndPassword(auth, email, pass);
        } else {
          if (!els.cat.value) throw new Error('Please pick your age group.');
          const cred = await createUserWithEmailAndPassword(auth, email, pass);
          await setDoc(doc(db, 'users', cred.user.uid), {category: els.cat.value});
        }
        location.href = 'dashboard.html';
      } catch (err) {
        els.banner.textContent = err.message;
        els.banner.hidden = false;
      } finally {
        els.submitBtn.disabled = false;
        els.submitBtn.setAttribute('aria-busy', 'false');
      }
    });

    els.forgotBtn.addEventListener('click', async () => {
      const email = els.email.value.trim();
      if (!email) return alert('Enter your email first.');
      try {
        await sendPasswordResetEmail(auth, email);
        alert('Reset link sent â€“ check your inbox!');
      } catch (err) {
        alert(err.message);
      }
    });

    // Dark/light toggle
    const html = document.documentElement;
    const stored = localStorage.getItem('theme');
    if (stored) html.classList.toggle('dark', stored === 'dark');
    document.getElementById('themeToggle').onclick = () => {
      const isDark = html.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    };
    renderMode();
  </script>
</body>
</html>